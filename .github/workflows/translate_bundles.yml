name: Translate L10n Java Bundles

permissions:
  contents: write
  pull-requests: write

on:
  workflow_dispatch:
    inputs:
      tgt_lang:
        description: 'Target language (must be supported by argostranslate)'
        required: true
        type: choice
        options:
          - ar
          - az
          - bg
          - bn
          - ca
          - cs
          - da
          - de
          - el
          - en
          - eo
          - es
          - et
          - eu
          - fa
          - fi
          - fr
          - ga
          - gl
          - he
          - hi
          - hu
          - id
          - it
          - ja
          - ko
          - ky
          - lt
          - lv
          - ms
          - nb
          - nl
          - pl
          - pt
          - ro
          - ru
          - sk
          - sl
          - sq
          - sr
          - sv
          - th
          - tl
          - tr
          - uk
          - ur
          - vi
          - zh

jobs:
  translate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: '3.12'
          cache: 'pip'

      - name: ðŸ“¦ Install dependencies
        run: | 
          pip install -r requirements.txt

      - name: ðŸ¤– Translate Java Resource Bundles
        run: |
          python scripts/translate_bundles.py --tgt "${{ github.event.inputs.tgt_lang }}"
        env:
          SRC_DIR: common/src/main/java/io/github/jy95/fds/common/l10n

      - name: ðŸ¤– Translate Java Test Files
        run: |
          python scripts/translate_java_test_strings.py --tgt-lang "${{ github.event.inputs.tgt_lang }}"
        env:
          SRC_DIR: common/src/main/resources

      - name: ðŸ’… Create Pull Request
        uses: peter-evans/create-pull-request@v8.0.0
        with:
          title: "feat(l10n): Add ${{ github.event.inputs.tgt_lang }} support"
          commit-message: "feat: translate l10n bundles to ${{ github.event.inputs.tgt_lang }}"
          branch: "automated/l10n-translation-${{ github.event.inputs.tgt_lang }}"
          base: main
          draft: true
          body: |
            This is an automated PR to add FHIR translation support for `${{ github.event.inputs.tgt_lang }}`.
            Generated using Argos Translate.  

            To complete this PR : 

            1. Add the locale in several places : 

               - [ ] [DosageMarkdown](https://github.com/jy95/fds/blob/main/common/src/main/java/io/github/jy95/fds/common/types/DosageMarkdown.java)
               - [ ] [LocaleProviderBase](https://github.com/jy95/fds/blob/main/common/src/test/java/io/github/jy95/fds/utilities/LocaleProviderBase.java)
               - [ ] [AbstractFhirTest R4](https://github.com/jy95/fds/blob/main/r4/src/test/java/io/github/jy95/fds/r4/AbstractFhirTest.java)
               - [ ] [AbstractFhirTest R5](https://github.com/jy95/fds/blob/main/r5/src/test/java/io/github/jy95/fds/r4/AbstractFhirTest.java)

            2. Create the ressource bundles for this locale in [l10n](https://github.com/jy95/fds/tree/main/common/src/main/java/io/github/jy95/fds/common/l10n) folder : 

               - [ ] [DosageFields](https://github.com/jy95/fds/blob/main/common/src/main/java/io/github/jy95/fds/common/l10n/DosageFields.java)
               - [ ] [EventTiming](https://github.com/jy95/fds/blob/main/common/src/main/java/io/github/jy95/fds/common/l10n/EventTiming.java)
               - [ ] [QuantityComparator](https://github.com/jy95/fds/blob/main/common/src/main/java/io/github/jy95/fds/common/l10n/QuantityComparator.java)


            3. Run tests and fix potential translations issues 
